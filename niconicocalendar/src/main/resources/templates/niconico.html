<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title>ニコニコカレンダー</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="../css/style.css" />
<script th:src="@{../js/jquery/jquery.js}"></script>
<script type="text/javascript">
	function selectFeeling() {
		location.href = "/select";
	}
	
	function registerUser() {
		var str = prompt("ユーザー名を入力して下さい。","");
		if (str == "") {
			alert("ユーザー名が入力されていません。もう一度確認して下さい。");
			registerUser();
		} else if (str != null) {
			var registForm = document.createElement("form");
			registForm.action = "/regist";
			registForm.method = "post";
			var registInput = document.createElement("input");
			registInput.setAttribute("type", "hidden");
			registInput.setAttribute("name", "name");
			registInput.setAttribute("value", str);
			registForm.appendChild(registInput);
			registForm.submit();
		}
	}
	
	function deleteUser(userId) {
		if(confirm("ユーザーを削除します。本当に宜しいでしょうか？")){
			var deleteForm = document.createElement("form");
			deleteForm.action = "/delete";
			deleteForm.method = "post";
			var deleteInput = document.createElement("input");
			deleteInput.setAttribute("type", "hidden");
			deleteInput.setAttribute("name", "userId");
			deleteInput.setAttribute("value", userId);
			deleteForm.appendChild(deleteInput);
			deleteForm.submit();
		}
		else{
			alert("キャンセルされました。");
		}
	}
</script>
</head>

<body>
	<div id="title">
		<h1>ニコニコカレンダー</h1>
	</div>

	<div class="month">
		<div class="lastmonth">
			<form>
				<input type="hidden" name="previous" th:value="${dispYear}+'/'+(${dispMonth}-1)" />
				<input type="submit" th:value="＜" />
			</form>
		</div>
		<div class="currentmonth" th:text="${dispYear}+年+' '+${dispMonth}+月"></div>
		<div class="nextmonth">
			<form>
				<input type="hidden" name="next" th:value="${dispYear}+'/'+(${dispMonth}+1)" />
				<input type="submit" th:value="＞" />
			</form>
		</div>
	</div>
	
	<table id="niconicoCalendar">
		<tr>
			<td>
				<div class="configDiv" onClick="registerUser()">
					<img class="registImg" th:src="@{/img/regist.png}" alt="追加" />
				</div>
			</td>
			<th class="userName">ユーザー名</th>
			<th class="historyCalendar" th:each="i : ${#numbers.sequence(1,lastDay)}" th:value="${i}" th:text="${i}" />
		</tr>

		<tr th:each="user:${user}">
			<td>
				<div class="configDiv" th:onClick="'deleteUser('+${user.userId}+')'">
					<img class="deleteImg" th:src="@{/img/delete.png}" />
				</div>
			</td>
			<td class="userName" th:text="${user.username}" />
	 		<td class="historyCalendar" th:each="i : ${#numbers.sequence(1,lastDay)}" th:value="${i}" style="cursor: pointer" onClick="selectFeeling()">
		 			<th:block th:each="feelingHistory:${feelingHistory}" th:if="${feelingHistory.userId == user.userId and feelingHistory.day == i}">
		 					<th:block th:each="feelings:${feelings}" th:if="${feelings.feelingId == feelingHistory.feelingId}">
		  						<img class="feelingImg" th:src="@{/img/{feelingName}.png(feelingName=${feelings.feeling})}" alt="" />
		 					</th:block>
		 			</th:block>
			</td>
		</tr>
	</table>

 	<form method="post" action="/feel" >
		<p>
			<select name="userId">
				<option th:each="user:${user}" th:value="${user.userId}" th:text="${user.username}"></option>
			</select>
			<input type="radio" name="feelingId" value="0" /><img th:src="@{/img/niconico.png}" alt="niconico" />
			<input type="radio" name="feelingId" value="1" /><img th:src="@{/img/iraira.png}" alt="iraira" />
			<input type="radio" name="feelingId" value="2" /><img th:src="@{/img/futsu.png}" alt="futsu" />
			<input type="radio" name="feelingId" value="3" /><img th:src="@{/img/shikushiku.png}" alt="shikushiku" />
			<input type="radio" name="feelingId" value="4" /><img th:src="@{/img/utouto.png}" alt="ututo" />
			<input type="submit" value="登録" />
		</p>
	</form>

<!-- 	 <form method="post" action="/delete">
		<p>
			<select name="userId">
				<option th:each="user:${user}" th:value="${user.userId}" th:text="${user.username}">
				</option>
			</select>
			<input type="submit" value="削除" />
		</p>
	</form> -->
	
</body>
</html>