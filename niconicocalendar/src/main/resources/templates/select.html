<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title>ニコニコカレンダー</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="../css/confirmStyle.css" />
<script th:src="@{../js/jquery/jquery.js}"></script>
<script type="text/javascript">
$(document).ready(function(){
	var feelingsNum = document.getElementById("getSelectedFeelingsNum").value;
	if(feelingsNum == -1){
		$("#deleteFeelings").prop("disabled", true);
	}
});

	$(function() {
		$("input[name='number']").change(function() {
			var userId = document.getElementById("getUserId").value;
			var year = document.getElementById("getYear").value;
			var month = document.getElementById("getMonth").value;
			var day = document.getElementById("getDay").value;
			selectFeelings(userId, year, month, day);
		});
	});

	function selectFeelings(userId, year, month, day) {
		var feelingsNum = $('[name=number]:checked').val();
		var selectForm = document.createElement("form");
		selectForm.action = "/register/feelings";
		selectForm.method = "post";
		var selectInput1 = document.createElement("input");
		selectInput1.setAttribute("type", "hidden");
		selectInput1.setAttribute("name", "userId");
		selectInput1.setAttribute("value", userId);
		selectForm.appendChild(selectInput1);
		var selectInput2 = document.createElement("input");
		selectInput2.setAttribute("type", "hidden");
		selectInput2.setAttribute("name", "year");
		selectInput2.setAttribute("value", year);
		selectForm.appendChild(selectInput2);
		var selectInput3 = document.createElement("input");
		selectInput3.setAttribute("type", "hidden");
		selectInput3.setAttribute("name", "month");
		selectInput3.setAttribute("value", month);
		selectForm.appendChild(selectInput3);
		var selectInput4 = document.createElement("input");
		selectInput4.setAttribute("type", "hidden");
		selectInput4.setAttribute("name", "day");
		selectInput4.setAttribute("value", day);
		selectForm.appendChild(selectInput4);
		var selectInput5 = document.createElement("input");
		selectInput5.setAttribute("type", "hidden");
		selectInput5.setAttribute("name", "feelingsNum");
		selectInput5.setAttribute("value", feelingsNum);
		selectForm.appendChild(selectInput5);
		selectForm.submit();
	}

	function deleteFeelings() {
		var userId = document.getElementById("getUserId").value;
		var year = document.getElementById("getYear").value;
		var month = document.getElementById("getMonth").value;
		var day = document.getElementById("getDay").value;
		var selectForm = document.createElement("form");
		selectForm.action = "/delete/feelings";
		selectForm.method = "post";
		var selectInput1 = document.createElement("input");
		selectInput1.setAttribute("type", "hidden");
		selectInput1.setAttribute("name", "userId");
		selectInput1.setAttribute("value", userId);
		selectForm.appendChild(selectInput1);
		var selectInput2 = document.createElement("input");
		selectInput2.setAttribute("type", "hidden");
		selectInput2.setAttribute("name", "year");
		selectInput2.setAttribute("value", year);
		selectForm.appendChild(selectInput2);
		var selectInput3 = document.createElement("input");
		selectInput3.setAttribute("type", "hidden");
		selectInput3.setAttribute("name", "month");
		selectInput3.setAttribute("value", month);
		selectForm.appendChild(selectInput3);
		var selectInput4 = document.createElement("input");
		selectInput4.setAttribute("type", "hidden");
		selectInput4.setAttribute("name", "day");
		selectInput4.setAttribute("value", day);
		selectForm.appendChild(selectInput4);
		selectForm.submit();
	}
</script>
</head>

<body>
	<div id="title">
		<h1>ニコニコカレンダー</h1>
	</div>

	<div class="windowDiv">
		<p id="selectedDate" th:text="${dispYear}+'/'+${dispMonth}+'/'+${day}" />
		<h2>登録内容を選択してください。</h2>
		<table class="list">
			<tr>
				<td class="check"><input type="radio" name="number" value="0" id="radio1" />
				<label class="label" for="radio1">
					<img th:src="@{/img/niconico.png}" alt="niconico" />
				</label></td>
				<td class="check"><input type="radio" name="number" value="1" id="radio2" />
				<label class="label" for="radio2">
					<img th:src="@{/img/iraira.png}" alt="iraira" />
				</label></td>
				<td class="check"><input type="radio" name="number" value="2" id="radio3" />
				<label class="label" for="radio3">
					<img th:src="@{/img/futsu.png}" alt="futsu" />
				</label></td>
				<td class="check"><input type="radio" name="number" value="3" id="radio4" />
				<label class="label" for="radio4">
					<img th:src="@{/img/shikushiku.png}" alt="shikushiku" />
				</label></td>
				<td class="check"><input type="radio" name="number" value="4" id="radio5" />
				<label class="label" for="radio5">
					<img th:src="@{/img/utouto.png}" alt="utouto" />
				</label></td>
			</tr>
		</table>
		<input class="button" id="selectCancel" type="button" value="キャンセル" onClick="history.back()"/>
		<input class="button" id="deleteFeelings" type="submit" value="登録内容を削除する" onClick="deleteFeelings()" />
	</div>
	
	<div class="month"></div>

	<table id="niconicoCalendar">
		<tr>
			<td>
				<div class="configDiv">
					<img class="registImg" th:src="@{/img/regist.png}" alt="追加" />
				</div>
			</td>
			<th class="userName">ユーザー名</th>
			<th class="historyCalendar" th:each="i : ${#numbers.sequence(1,lastDay)}" th:value="${i}" th:text="${i}" />
		</tr>

		<tr th:each="user:${users}">
			<td>
				<div class="configDiv">
					<img class="configImg" th:src="@{/img/config.png}" />
				</div>
			</td>
			<td class="userName" th:text="${user.userName}" />
	 			<td class="feelingsHistoryCalendar" th:each="i : ${#numbers.sequence(1,lastDay)}" th:value="${i}">
		 				<th:block th:each="feelingsHistory:${feelingsHistory}" th:if="${feelingsHistory.userId == user.userId and feelingsHistory.day == i}">
		 						<th:block th:each="feelingsList:${feelingsList}" th:if="${feelingsList.feelingsNum == feelingsHistory.feelingsNum}">
		  							<img class="feelingsImg" th:src="@{/img/{feelingsName}.png(feelingsName=${feelingsList.feelings})}" alt="" />
		 						</th:block>
		 				</th:block>
				</td>
		</tr>
	</table>

	<!-- 各種情報を受け取り -->
	<input type="hidden" id="getUserId" th:value="${userId}" />
	<input type="hidden" id="getYear" th:value="${dispYear}" />
	<input type="hidden" id="getMonth" th:value="${dispMonth}" />
	<input type="hidden" id="getDay" th:value="${day}" />
	<input type="hidden" id="getSelectedFeelingsNum" th:value="${selectedFeelingsNum}" />

</body>
</html>